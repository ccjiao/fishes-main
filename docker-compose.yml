services:
  fishes-web:
    build:
      context: https://github.com/ccjiao/fishes-main/archive/refs/heads/main.tar.gz
      dockerfile: docker/Dockerfile
    container_name: fishes-web
    ports:
      - "8080:8080"
    networks:
      corp_net:
        aliases:
          - fishes-web
    volumes:
      - /mnt/nas/fishes/logs:/var/log/nginx
      - /mnt/nas/fishes/config/env-config.js:/usr/share/nginx/html/env-config.js:ro
    healthcheck:
      test: ["CMD-SHELL","wget -q --spider http://localhost:8080/health || exit 1"]
      interval: 30s
      timeout: 3s
      retries: 3
      start_period: 10s
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "5"
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: "1.0"
          memory: "512M"
        reservations:
          cpus: "0.25"
          memory: "128M"
networks:
  corp_net:
    external: true
